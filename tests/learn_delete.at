AT_BANNER([learning delete action])

AT_SETUP([learning delete action - Delete all rules in a single table])
# Set up flow tables
OVS_VSWITCHD_START

AT_CHECK([ovs-ofctl add-flow br0 "table=150 priority=10 actions=learn_delete(table=210)"])
AT_CHECK([ovs-ofctl add-flow br0 "table=210 priority=10 actions=note:00.00.00"])
AT_CHECK([ovs-ofctl add-flow br0 "table=210 priority=12 actions=note:00.00.01"])

# Have a packet delete all rules in table 201
flow = "in_port(3),eth(src=11:22:33:44:55:66,dst=99:88:77:66:55:44)"
AT_CHECK([ovs-appctl ofproto/trace ovs-dummy "in_port(3),eth(src=11:22:33:44:55:66,dst=99:88:77:66:55:44)" -generate], [0], [stdout])
AT_CHECK([ovs-ofctl dump-flows br0 | ofctl_strip | sort], [0], [dnl
 table=150, priority=10, actions=learn_delete(table=210)
NXST_FLOW reply:
])
OVS_VSWITCHD_STOP
AT_CLEANUP
